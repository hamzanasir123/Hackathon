---
sidebar_label: "Package Building Tutorial"
sidebar_position: 6
title: "Package Building Tutorial"
description: "Step-by-step guide to creating and building complete ROS 2 packages with Python nodes"
---

import ConceptExplainer from '@site/src/components/ConceptExplainer';
import CodeExample from '@site/src/components/CodeExample';
import RosPackageExample from '@site/src/components/RosPackageExample';

# Package Building Tutorial

In this section, we'll walk through the complete process of creating a ROS 2 package, implementing nodes, and building the package. This hands-on tutorial will give you practical experience with the entire development workflow.

## Learning Objectives

After completing this section, you will be able to:

- Create a complete ROS 2 package with multiple nodes
- Configure package files (package.xml, setup.py)
- Build and run the package
- Create launch files to orchestrate multiple nodes
- Understand the complete development workflow

## Table of Contents

1. [Setting Up Your Workspace](#setting-up-your-workspace)
2. [Creating a New Package](#creating-a-new-package)
3. [Package Structure](#package-structure)
4. [Implementing Nodes](#implementing-nodes)
5. [Configuring the Package](#configuring-the-package)
6. [Building the Package](#building-the-package)
7. [Running the Package](#running-the-package)
8. [Creating Launch Files](#creating-launch-files)
9. [Complete Example](#complete-example)
10. [Best Practices](#best-practices)
11. [Exercises](#exercises)

## Setting Up Your Workspace

Before creating a package, you need to set up your ROS 2 workspace:

```bash
# Create a workspace directory
mkdir -p ~/ros2_projects/ws_tutorial/src
cd ~/ros2_projects/ws_tutorial

# Source the ROS 2 installation
source /opt/ros/humble/setup.bash  # or your ROS 2 distribution
```

## Creating a New Package

Use the `ros2 pkg create` command to create a new package:

```bash
cd ~/ros2_projects/ws_tutorial/src
ros2 pkg create --build-type ament_python my_robot_package
```

This creates a basic package structure with Python support.

## Package Structure

A typical ROS 2 Python package has the following structure:

```
my_robot_package/
├── my_robot_package/           # Python package directory
│   ├── __init__.py            # Python package initialization
│   ├── publisher_node.py      # Example publisher node
│   ├── subscriber_node.py     # Example subscriber node
│   ├── service_server.py      # Example service server
│   └── service_client.py      # Example service client
├── launch/                    # Launch files directory
│   ├── simple_launch.py       # Python launch file
│   └── complex_launch.py      # More complex launch file
├── test/                      # Test files
├── package.xml                # Package metadata
├── setup.cfg                  # Installation instructions
├── setup.py                   # Python package configuration
├── README.md                  # Package documentation
└── LICENSE                    # License file
```

## Implementing Nodes

Let's implement several nodes for our package:

### Publisher Node

<CodeExample
  title="Publisher Node Implementation"
  language="python"
  code={`# my_robot_package/publisher_node.py
import rclpy
from rclpy.node import Node
from std_msgs.msg import String
from geometry_msgs.msg import Twist

class RobotPublisher(Node):
    def __init__(self):
        super().__init__('robot_publisher')

        # Create publisher for velocity commands
        self.vel_publisher = self.create_publisher(Twist, 'cmd_vel', 10)

        # Create publisher for status messages
        self.status_publisher = self.create_publisher(String, 'robot_status', 10)

        # Create a timer to publish messages
        timer_period = 0.1  # seconds (10 Hz)
        self.timer = self.create_timer(timer_period, self.timer_callback)

        self.i = 0

    def timer_callback(self):
        # Publish velocity command
        vel_msg = Twist()
        vel_msg.linear.x = 0.5  # Move forward at 0.5 m/s
        vel_msg.angular.z = 0.2  # Rotate at 0.2 rad/s
        self.vel_publisher.publish(vel_msg)

        # Publish status message
        status_msg = String()
        status_msg.data = f'Robot status: Running iteration {self.i}'
        self.status_publisher.publish(status_msg)

        self.get_logger().info(f'Published velocity: linear={vel_msg.linear.x}, angular={vel_msg.angular.z}')
        self.i += 1

def main(args=None):
    rclpy.init(args=args)
    robot_publisher = RobotPublisher()

    try:
        rclpy.spin(robot_publisher)
    except KeyboardInterrupt:
        robot_publisher.get_logger().info('Shutting down publisher node...')
    finally:
        robot_publisher.destroy_node()
        rclpy.shutdown()

if __name__ == '__main__':
    main()`}
  explanation="A publisher node that sends velocity commands and status updates. It publishes to both 'cmd_vel' and 'robot_status' topics at 10 Hz."
/>

### Subscriber Node

<CodeExample
  title="Subscriber Node Implementation"
  language="python"
  code={`# my_robot_package/subscriber_node.py
import rclpy
from rclpy.node import Node
from std_msgs.msg import String
from geometry_msgs.msg import Twist

class RobotSubscriber(Node):
    def __init__(self):
        super().__init__('robot_subscriber')

        # Create subscription for velocity commands
        self.vel_subscription = self.create_subscription(
            Twist,
            'cmd_vel',
            self.vel_callback,
            10
        )

        # Create subscription for status messages
        self.status_subscription = self.create_subscription(
            String,
            'robot_status',
            self.status_callback,
            10
        )

        # Store the last received data
        self.last_velocity = None
        self.last_status = None

    def vel_callback(self, msg):
        self.last_velocity = (msg.linear.x, msg.angular.z)
        self.get_logger().info(f'Received velocity: linear={msg.linear.x}, angular={msg.angular.z}')

    def status_callback(self, msg):
        self.last_status = msg.data
        self.get_logger().info(f'Received status: {msg.data}')

def main(args=None):
    rclpy.init(args=args)
    robot_subscriber = RobotSubscriber()

    try:
        rclpy.spin(robot_subscriber)
    except KeyboardInterrupt:
        robot_subscriber.get_logger().info('Shutting down subscriber node...')
    finally:
        robot_subscriber.destroy_node()
        rclpy.shutdown()

if __name__ == '__main__':
    main()`}
  explanation="A subscriber node that listens to velocity commands and status messages. It processes both types of messages in separate callbacks."
/>

## Configuring the Package

### package.xml

The `package.xml` file contains metadata about your package:

```xml
<?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>my_robot_package</name>
  <version>0.0.1</version>
  <description>A tutorial package demonstrating ROS 2 concepts</description>
  <maintainer email="you@example.com">Your Name</maintainer>
  <license>Apache License 2.0</license>

  <depend>rclpy</depend>
  <depend>std_msgs</depend>
  <depend>geometry_msgs</depend>
  <depend>example_interfaces</depend>

  <test_depend>ament_copyright</test_depend>
  <test_depend>ament_flake8</test_depend>
  <test_depend>ament_pep257</test_depend>
  <test_depend>python3-pytest</test_depend>

  <export>
    <build_type>ament_python</build_type>
  </export>
</package>
```

### setup.py

The `setup.py` file configures how your package is built and installed:

```python
from setuptools import setup
import os
from glob import glob

package_name = 'my_robot_package'

setup(
    name=package_name,
    version='0.0.1',
    packages=[package_name],
    data_files=[
        ('share/ament_index/resource_index/packages',
            ['resource/' + package_name]),
        ('share/' + package_name, ['package.xml']),
        # Include all launch files
        (os.path.join('share', package_name, 'launch'), glob('launch/*.py')),
    ],
    install_requires=['setuptools'],
    zip_safe=True,
    maintainer='Your Name',
    maintainer_email='you@example.com',
    description='A tutorial package demonstrating ROS 2 concepts',
    license='Apache License 2.0',
    tests_require=['pytest'],
    entry_points={
        'console_scripts': [
            'publisher_node = my_robot_package.publisher_node:main',
            'subscriber_node = my_robot_package.subscriber_node:main',
            'service_server = my_robot_package.service_server:main',
            'service_client = my_robot_package.service_client:main',
        ],
    },
)
```

### setup.cfg

The `setup.cfg` file contains installation instructions:

```
[develop]
script-dir=$base/lib/my_robot_package
[install]
install-scripts=$base/lib/my_robot_package
```

## Building the Package

To build your ROS 2 package:

```bash
# Navigate to your workspace
cd ~/ros2_projects/ws_tutorial

# Build the specific package
colcon build --packages-select my_robot_package

# Or build all packages in the workspace
colcon build

# Source the setup file to use the built package
source install/setup.bash
```

## Running the Package

After building, you can run your nodes:

```bash
# Run the publisher node
ros2 run my_robot_package publisher_node

# Run the subscriber node in another terminal
ros2 run my_robot_package subscriber_node
```

## Creating Launch Files

Launch files allow you to start multiple nodes with a single command:

<CodeExample
  title="Python Launch File"
  language="python"
  code={`# launch/simple_launch.py
from launch import LaunchDescription
from launch_ros.actions import Node

def generate_launch_description():
    return LaunchDescription([
        Node(
            package='my_robot_package',
            executable='publisher_node',
            name='robot_publisher',
            output='screen',
        ),
        Node(
            package='my_robot_package',
            executable='subscriber_node',
            name='robot_subscriber',
            output='screen',
        ),
    ])
`}
  explanation="A launch file that starts both the publisher and subscriber nodes. The 'output' parameter ensures that node logs are visible in the terminal."
/>

To run the launch file:

```bash
# From your workspace directory after sourcing
ros2 launch my_robot_package simple_launch.py
```

## Complete Example

Here's a complete example of setting up and running a ROS 2 package:

```bash
# 1. Create workspace and navigate to it
mkdir -p ~/ros2_projects/ws_complete/src
cd ~/ros2_projects/ws_complete

# 2. Source ROS 2
source /opt/ros/humble/setup.bash

# 3. Create the package
cd src
ros2 pkg create --build-type ament_python robot_demo

# 4. Navigate to the package
cd robot_demo

# 5. Create the node files (use the examples above)

# 6. Update package.xml with dependencies

# 7. Update setup.py with entry points

# 8. Create launch directory and files
mkdir launch

# 9. Navigate back to workspace and build
cd ~/ros2_projects/ws_complete
colcon build --packages-select robot_demo

# 10. Source the workspace
source install/setup.bash

# 11. Run the nodes
ros2 run robot_demo publisher_node
# In another terminal:
ros2 run robot_demo subscriber_node
```

## Running Our Example Packages

We've created several complete example packages that demonstrate different ROS 2 concepts. You can find them in the examples/ros2_packages directory:

<RosPackageExample
  title="Publisher-Subscriber Example Package"
  description="Demonstrates basic publisher and subscriber nodes with topic communication"
  packageName="publisher_subscriber_example"
  packagePath="/examples/ros2_packages/publisher_subscriber_example"
  runInstructions={[
    "Terminal 1 - Start the publisher:",
    "ros2 run publisher_subscriber_example publisher_member_function",
    "",
    "Terminal 2 - Start the subscriber:",
    "ros2 run publisher_subscriber_example subscriber_member_function"
  ]}
/>

<RosPackageExample
  title="Service Example Package"
  description="Demonstrates service server and client implementation"
  packageName="service_example"
  packagePath="/examples/ros2_packages/service_example"
  runInstructions={[
    "Terminal 1 - Start the service server:",
    "ros2 run service_example service_server",
    "",
    "Terminal 2 - Run the service client:",
    "ros2 run service_example service_client 10 20"
  ]}
/>

<RosPackageExample
  title="Action Example Package"
  description="Demonstrates action server and client implementation using Fibonacci sequence"
  packageName="action_example"
  packagePath="/examples/ros2_packages/action_example"
  runInstructions={[
    "Terminal 1 - Start the action server:",
    "ros2 run action_example fibonacci_action_server",
    "",
    "Terminal 2 - Run the action client:",
    "ros2 run action_example fibonacci_action_client"
  ]}
/>

## Best Practices

When creating and building ROS 2 packages, follow these best practices:

1. **Use descriptive package names** that clearly indicate the package's purpose
2. **Organize nodes logically** with clear naming conventions
3. **Document your code** with clear comments and docstrings
4. **Handle errors gracefully** with proper exception handling
5. **Use appropriate QoS settings** for your application's requirements
6. **Create meaningful launch files** to simplify system startup
7. **Test incrementally** by building and testing components as you develop

### Example: Well-Structured Package

<CodeExample
  title="Well-Structured Package Example"
  language="python"
  code={`# my_robot_package/robot_controller.py
import rclpy
from rclpy.node import Node
from std_msgs.msg import String
from geometry_msgs.msg import Twist
from sensor_msgs.msg import LaserScan
from my_robot_package.utils import safety_check  # Custom utility module

class RobotController(Node):
    """
    A robot controller node that processes sensor data and generates commands.

    This node subscribes to sensor data, processes it, and publishes velocity commands.
    It includes safety checks and proper error handling.
    """

    def __init__(self):
        super().__init__('robot_controller')

        # Create publishers
        self.cmd_publisher = self.create_publisher(Twist, 'cmd_vel', 10)

        # Create subscriptions
        self.scan_subscription = self.create_subscription(
            LaserScan,
            'scan',
            self.scan_callback,
            10
        )

        # Timer for control loop
        self.control_timer = self.create_timer(0.05, self.control_loop)  # 20 Hz

        # Robot state
        self.safety_enabled = True
        self.last_scan = None

        self.get_logger().info('Robot controller initialized')

    def scan_callback(self, msg):
        """Process laser scan data."""
        self.last_scan = msg
        self.get_logger().debug(f'Received scan with {len(msg.ranges)} ranges')

    def control_loop(self):
        """Main control loop."""
        if self.last_scan is None:
            return

        # Perform safety check
        if self.safety_enabled:
            safe, reason = safety_check(self.last_scan)
            if not safe:
                self.get_logger().warn(f'Safety violation: {reason}')
                self.stop_robot()
                return

        # Generate velocity command based on sensor data
        cmd = self.generate_velocity_command(self.last_scan)
        self.cmd_publisher.publish(cmd)

    def generate_velocity_command(self, scan_data):
        """Generate velocity command based on scan data."""
        # Simple obstacle avoidance logic
        min_distance = min(scan_data.ranges)

        cmd = Twist()
        if min_distance > 1.0:  # Safe distance
            cmd.linear.x = 0.3  # Move forward
            cmd.angular.z = 0.0
        elif min_distance > 0.5:  # Approaching obstacle
            cmd.linear.x = 0.1
            cmd.angular.z = 0.2  # Turn slightly
        else:  # Too close to obstacle
            cmd.linear.x = 0.0
            cmd.angular.z = 0.5  # Turn more sharply

        return cmd

    def stop_robot(self):
        """Stop the robot immediately."""
        stop_cmd = Twist()
        stop_cmd.linear.x = 0.0
        stop_cmd.angular.z = 0.0
        self.cmd_publisher.publish(stop_cmd)

def main(args=None):
    rclpy.init(args=args)
    controller = RobotController()

    try:
        rclpy.spin(controller)
    except KeyboardInterrupt:
        controller.get_logger().info('Shutting down robot controller...')
    finally:
        controller.stop_robot()  # Ensure robot stops on shutdown
        controller.destroy_node()
        rclpy.shutdown()

if __name__ == '__main__':
    main()`}
  explanation="A well-structured robot controller node with proper documentation, error handling, and safety checks. It demonstrates best practices for ROS 2 node development."
/>

## Exercises


  <h4 className="exercise-title">Exercise 1: Create Your Own Package</h4>
  <p>Create a complete ROS 2 package with at least 3 nodes: a sensor simulator, a data processor, and an actuator controller. The sensor simulator should publish mock sensor data, the data processor should process it, and the actuator controller should respond to processed data.</p>



  <h4 className="exercise-title">Exercise 2: Launch File Configuration</h4>
  <p>Create a launch file that starts your package's nodes with specific parameters. Use the launch file to set different configuration values for each node.</p>



  <h4 className="exercise-title">Exercise 3: Error Handling</h4>
  <p>Enhance your nodes with comprehensive error handling. Add checks for common issues like missing dependencies, invalid parameters, and communication failures.</p>



  <h4 className="exercise-title">Exercise 4: Build and Test</h4>
  <p>Build your complete package, run it with the launch file, and verify that all components work together. Test different scenarios to ensure robust operation.</p>
